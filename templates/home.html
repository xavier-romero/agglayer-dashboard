{% extends "base.html" %}

{% block title %}AggLayer Dashboard - Kurtosis{% endblock %}

{% block content %}
<h2>Kurtosis Environment</h2>

<div class="card">
    {% if summary.isConnected %}
    <p class="status-connected">‚úÖ Connected to L1 RPC</p>
    {% else %}
    <p class="status-error">‚ùå L1 RPC Connection Error</p>
    {% endif %}
    
    {% if summary.error %}
    <p class="status-error">Error: {{ summary.error }}</p>
    {% else %}
    <table class="detail-table">
        <tr>
            <th>RPC URL</th>
            <td><code>{{ summary.rpcURL }}</code></td>
        </tr>
        <tr>
            <th>Rollup Manager</th>
            <td><code>{{ summary.rollupManagerAddress }}</code></td>
        </tr>
        {% if summary.aggLayerURL %}
        <tr>
            <th>AggLayer URL</th>
            <td><code>{{ summary.aggLayerURL }}</code></td>
        </tr>
        {% endif %}
        <tr>
            <th>Total Rollups</th>
            <td>{{ summary.rollupCount or 0 }}</td>
        </tr>
        {% if summary.epochConfig %}
        <tr>
            <th>Epoch Duration</th>
            <td>{{ summary.epochConfig.epoch_duration }} seconds</td>
        </tr>
        <tr>
            <th>Genesis Block</th>
            <td>{{ summary.epochConfig.genesis_block }}</td>
        </tr>
        {% endif %}
        {% if summary.networkAddresses %}
        <tr style="border-top: 2px solid #eee;">
            <th colspan="2" style="text-align: center; padding: 10px; background-color: #f8f9fa; font-weight: bold;">Network Contract Addresses</th>
        </tr>
        <tr>
            <th>Bridge Contract</th>
            <td><code>{{ summary.networkAddresses.bridgeAddress }}</code></td>
        </tr>
        <tr>
            <th>Global Exit Root Manager</th>
            <td><code>{{ summary.networkAddresses.globalExitRootManager }}</code></td>
        </tr>
        <tr>
            <th>POL Token</th>
            <td><code>{{ summary.networkAddresses.polAddress }}</code></td>
        </tr>
        {% if summary.networkAddresses.aggLayerGatewayAddress %}
        <tr>
            <th>AggLayer Gateway</th>
            <td><code>{{ summary.networkAddresses.aggLayerGatewayAddress }}</code></td>
        </tr>
        {% endif %}
        {% endif %}
    </table>
    {% endif %}
</div>

{% if not summary.error %}
<h2>Active Network Counts</h2>

<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{ summary.rollupCount or 0 }}</div>
        <div class="stat-label">Total Rollups</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ summary.activeCounts.zkEVM or 0 }}</div>
        <div class="stat-label">Active zkEVM</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ summary.activeCounts.PP or 0 }}</div>
        <div class="stat-label">Active PP</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ summary.activeCounts.ALGateway or 0 }}</div>
        <div class="stat-label">Active ALGateway</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ summary.activeCounts.Validium or 0 }}</div>
        <div class="stat-label">Active Validium</div>
    </div>
</div>

<h2>All Rollups</h2>

<div class="rollup-grid">
    {% for rollup in rollups %}
    <div class="rollup-card {% if rollup.isActive %}rollup-active{% else %}rollup-inactive{% endif %}">
        <h3>
            Rollup {{ rollup.rollupID }}
            <span class="badge badge-{{ rollup.type }}">{{ rollup.type }}</span>
        </h3>
        
        <p><strong>Network:</strong> {{ rollup.networkName or 'Unknown' }}</p>
        <p><strong>Chain ID:</strong> {{ rollup.chainID }}</p>
        <p><strong>Status:</strong> 
            {% if rollup.isActive %}
            <span class="status-connected">Active</span>
            {% else %}
            <span class="status-error">Inactive</span>
            {% endif %}
        </p>
        
        {% if rollup.rollupContract != "0x0000000000000000000000000000000000000000" %}
        <p><strong>Contract:</strong> <code>{{ rollup.rollupContract[:10] }}...{{ rollup.rollupContract[-8:] }}</code></p>
        {% endif %}
        
        {% if rollup.trustedSequencerURL %}
        <p><strong>Sequencer:</strong> <code>{{ rollup.trustedSequencerURL }}</code></p>
        {% endif %}
        
        <div style="margin-top: 15px;">
            <a href="/rollup/{{ rollup.rollupID }}" 
               style="display: inline-block; padding: 8px 16px; background-color: #007bff; color: white; text-decoration: none; border-radius: 4px; font-weight: bold;">
                üìã View Details
            </a>
        </div>
    </div>
    {% endfor %}
</div>

{% if not rollups %}
<div class="card">
    <h3>No Rollups Found</h3>
    <p>This environment has no configured rollups yet.</p>
</div>
{% endif %}

{% endif %}
{% endblock %}